<!DOCTYPE html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org">
<link rel="icon" type="image/svg+xml"
      href="https://bizweb.dktcdn.net/100/048/601/themes/734017/assets/index-cate-icon-4.png?1610907247309"/>
<div th:replace="~{client/fragmentsClient/head :: head}"></div>
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/css/output.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<style>
    .default-customer-img {
        width: 30px; /* Kích thước của ảnh */
        height: 30px; /* Kích thước của ảnh */
        border-radius: 50%; /* Làm tròn ảnh */
    }

    /* Đặt container với Flexbox */
    .account-container {
        display: flex;
        align-items: center; /* Căn giữa hình ảnh và văn bản theo chiều dọc */
    }

    /* Chỉnh kích thước và tạo hình tròn cho ảnh */
    .default-customer-img {
        width: 40px; /* Kích thước của ảnh */
        height: 40px; /* Kích thước của ảnh */
        border-radius: 50%; /* Làm tròn ảnh */
        margin-right: 10px; /* Khoảng cách giữa ảnh và văn bản */
    }

    /* Định dạng cho văn bản */
    .account-text {
        font-size: 16px; /* Kích thước chữ */
        color: #333; /* Màu chữ */
    }

    .error {
        color: red;
        font-size: 14px;
    }

    .hidden {
        display: none;
    }

    /* Active state for the links */
    .active-link {
        color: orange;
    }
    /* Modal Background */
    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content */
    .modal-content {
        background-color: #fefefe;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 80%; /* Could be more or less, depending on screen size */
    }

    /* Close Button */
    .close-btn {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close-btn:hover,
    .close-btn:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    /* Grid Layout */
    .grid {
        display: grid;
        gap: 1rem;
    }

    .grid-cols-3 {
        grid-template-columns: repeat(3, 1fr);
    }
    .modal {
        display: none; /* Ẩn modal khi không cần thiết */
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 10% auto; /* Tạo khoảng cách từ trên và căn giữa */
        padding: 20px;
        border: 1px solid #888;
        width: 50%; /* Giảm kích thước modal */
        max-width: 600px; /* Đặt kích thước tối đa */
        border-radius: 8px;
        box-shadow: 0px 0px 10px rgba(0,0,0,0.1);
    }

    .modal-header h2 {
        margin: 0;
    }

    .close-btn {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close-btn:hover,
    .close-btn:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .modal-body {
        margin: 15px 0;
    }

    .form-group {
        margin-bottom: 15px;
    }

    .form-control {
        width: 100%;
        padding: 10px;
        box-sizing: border-box;
    }

    .modal-footer {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
    }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn-primary {
        background-color: #007bff;
        color: white;
    }

    .btn-secondary {
        background-color: #6c757d;
        color: white;
    }
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background-color: #4CAF50;
        color: white;
        padding: 15px;
        border-radius: 5px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        display: none;
        z-index: 1000;
    }

    .notification .progress-bar {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background-color: #fff;
        transition: width 3s linear; /* Thời gian hiển thị thông báo (3 giây) */
    }
</style>
<body class="bg-white">

<div th:replace="~{client/fragmentsClient/header :: header}"></div>
<div>
    <div class="flex justify-center">
        <div class="container bg-gray-100 w-[85%] p-2 rounded-lg shadow-md mt-32 flex gap-40">
            <div class="m-5">
                <div>
                    <img src="https://png.pngtree.com/png-vector/20190704/ourlarge/pngtree-vector-user-young-boy-avatar-icon-png-image_1538408.jpg"
                         alt="Ảnh khách hàng mặc định" class="default-customer-img">
                    <span id="tenKhachHang" class="font-bold text-l"></span>
                </div>
                <div class="mt-5">
                    <div class="account-container d-block">
                        <div class="d-flex">
                            <img src="https://png.pngtree.com/png-vector/20190805/ourlarge/pngtree-account-avatar-user-abstract-circle-background-flat-color-icon-png-image_1650938.jpg"
                                 alt="Ảnh khách hàng mặc định" class="default-customer-img">
                            <strong style="margin-top: 5px">
                                <a href="#" id="taiKhoanLink" style="color: orange">Tài khoản</a>
                            </strong>
                        </div>
                        <span class="account-text">
                            <ul style="list-style-type: none; padding: 0; margin-left: 50px">
                                <li><a href="#" id="hoSoLink">Hồ sơ</a></li>
                                <li><a href="#" id="diaChiLink">Địa chỉ</a></li>
                                <li><a href="#" id="doiMatKhauLink">Đổi mật khẩu</a></li>
                            </ul>
                        </span>
                    </div>
                    <div class="account-container">
                        <img src="https://imaxmobile.vn/media/data/icon-giao-hang-toan-quoc.jpeg"
                             alt="Ảnh khách hàng mặc định" class="default-customer-img">
                        <div class="text-orange-500"><strong><a href="/thong-tin-don-hang" style="color: #0c0e12">Đơn
                            mua</a></strong></div>
                    </div>
                </div>
            </div>

            <div id="formContainer">
                <div style="margin-top: 20px">
                    <form class="row g-3"
                          enctype="multipart/form-data" id="myForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ten" class="form-label">Tên Khách Hàng:</label>
                                    <input type="text" id="ten" name="ten" class="form-control"
                                           placeholder="Nhập tên Khách Hàng">
                                    <div id="tenError" class="error"></div>
                                </div>
                                <div class="mb-3">
                                    <label for="sdt" class="form-label">Số Điện Thoại:</label>
                                    <input type="text" id="sdt" name="sdt" class="form-control"
                                           placeholder="Nhập SĐT" disabled="true">
                                    <div id="sdtError" class="error"></div>
                                </div>
                                <div class="mb-3">
                                    <label for="cccd" class="form-label">CCCD:</label>
                                    <input type="text" id="cccd" name="cccd" class="form-control"
                                           placeholder="Nhập CCCD">
                                    <div id="cccdError" class="error"></div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="ngaySinh" class="form-label">Ngày Sinh:</label>
                                    <input type="date" id="ngaySinh" name="ngaySinh" class="form-control"
                                           required>

                                    <div id="ngaySinhError" class="error"></div>
                                </div>

                                <div class="mb-3">
                                    <label for="email" class="form-label">Email:</label>
                                    <input type="email" id="email" name="email" class="form-control"
                                           placeholder="Nhập Email" disabled="true">
                                    <div id="emailError" class="error"></div>

                                </div>
                                <h1> Thay Đổi </h1>
                                <div class="form-group mb-3">
                                    <label class="form-label">Giới Tính:</label>
                                    <div class="custom-radio-group">
                                        <div class="custom-radio-label">
                                            <input class="custom-radio-input" type="radio" id="nam"
                                                   name="gioiTinh" value="true" checked>
                                            <label class="form-check-label" for="nam">Nam</label>
                                        </div>
                                        <div class="custom-radio-label">
                                            <input class="custom-radio-input" type="radio" id="nu"
                                                   name="gioiTinh" value="false">
                                            <label class="form-check-label" for="nu">Nữ</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center">
                            <button type="button" class="btn btn-primary me-2" id="confirmButton" onclick="check123()">
                                Lưu
                            </button>
                            <a th:href="@{/Client}" class="btn btn-secondary">Đóng</a>
                        </div>
                    </form>
                </div>
            </div>

            <div id="diachi" class="hidden text-center text-2xl font-bold mt-5">
                <div class="d-flex align-items-center mb-3">
                    <p class=""><i class="bi bi-geo-alt-fill"></i> Địa chỉ Của Tôi</p>
                    <div class="ms-auto">
                        <a class="btn btn-outline-primary btn-sm" onclick="showform()">Thêm mới</a>
                    </div>
                </div>
                <div class="mb-3">
                    <div id="address-details">

                    </div>
                </div>

            </div>

            <div id="helloDiv" class="hidden text-center text-2xl font-bold mt-5">
                <div class="mb-4">
                    <label for="matkhauhientai" class="block text-left text-sm font-medium text-gray-700 mb-2">Nhập Mật Khẩu Cũ</label>
                    <input type="password" id="matkhauhientai" name="matkhauhientai" required class="w-full p-2 border border-gray-300 rounded">
                    <span class="error-message" id="matkhauhientaiError" style="color: red; display: none;">Vui lòng nhập mật khẩu cũ.</span>
                </div>
                <div class="mb-4">
                    <label for="matkhaumoi" class="block text-left text-sm font-medium text-gray-700 mb-2">Nhập Mật Khẩu Mới</label>
                    <input type="password" id="matkhaumoi" name="matkhaumoi" required class="w-full p-2 border border-gray-300 rounded">
                    <span class="error-message" id="matkhaumoiError" style="color: red; display: none;">Vui lòng nhập mật khẩu mới.</span>
                </div>
                <div class="mb-4">
                    <label for="nhaplaimatkhaumoi" class="block text-left text-sm font-medium text-gray-700 mb-2">Nhập Lại Mật Khẩu Mới</label>
                    <input type="password" id="nhaplaimatkhaumoi" name="nhaplaimatkhaumoi" required class="w-full p-2 border border-gray-300 rounded">
                    <span class="error-message" id="nhaplaimatkhaumoiError" style="color: red; display: none;">Mật khẩu nhập lại không khớp với mật khẩu mới.</span>
                </div>

                <button type="button" class="btn btn-primary" onclick="doimatkhau()">Lưu</button>
            </div>


            <div class="modal" id="myModal">
                <div class="modal-content">
                    <span class="close-btn">&times;</span>
                    <div class="modal-header">
                        <h2>Chỉnh sửa địa chỉ</h2>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="tennguoinhan2">Tên Người Nhận</label>
                            <input type="text" class="form-control" id="tennguoinhan2">
                            <span class="error-message" id="edit-tennguoinhanError" style="color: red; display: none;">Vui lòng nhập tên người nhận.</span>
                        </div>

                        <div class="row">
                            <div class="col-4">
                                <select class="form-select form-select-sm mb-3" id="tinhThanh" aria-label="Chọn tỉnh thành">
                                    <option value="" selected>Chọn tỉnh thành</option>
                                    <!-- Add your options here -->
                                </select>
                                <span class="error-message" id="errorTinhThanh" style="color: red; display: none;">Vui lòng chọn tỉnh thành.</span>
                            </div>
                            <div class="col-4">
                                <select class="form-select form-select-sm mb-3" id="quanHuyen" aria-label="Chọn quận huyện">
                                    <option value="" selected>Chọn quận huyện</option>
                                    <!-- Add your options here -->
                                </select>
                                <span class="error-message" id="errorQuanHuyen" style="color: red; display: none;">Vui lòng chọn quận huyện.</span>
                            </div>
                            <div class="col-4">
                                <select class="form-select form-select-sm mb-3" id="phuongXa" aria-label="Chọn phường xã">
                                    <option value="" selected>Chọn phường xã</option>
                                    <!-- Add your options here -->
                                </select>
                                <span class="error-message" id="errorPhuongXa" style="color: red; display: none;">Vui lòng chọn phường xã.</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <label>Địa chỉ Chi tiết:</label>
                                <div class="form-group col-12">
                                    <textarea class="form-control" id="dcupdate" name="diachi" rows="3"></textarea>
                                    <span class="error-message" id="errorDiaChi" style="color: red; display: none;">Vui lòng nhập địa chỉ cụ thể.</span>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" id="save-btn" onclick="updatediachi()">Lưu</button>
                    </div>
                </div>
            </div>
            <div class="modal" id="mythemModal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <div class="modal-header">
                        <h2>Thêm địa chỉ</h2>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label for="tennguoinhan1">Tên Người Nhận</label>
                            <input type="text" class="form-control" id="tennguoinhan1">
                            <span class="error-message" id="tennguoinhanError" style="color: red; display: none;">Vui lòng nhập tên người nhận.</span>
                        </div>
                        <div class="row">
                            <div class="col-4">
                                <select class="form-select form-select-sm mb-3" id="city" aria-label="Chọn tỉnh thành">
                                    <option value="" selected>Chọn tỉnh thành</option>
                                    <!-- Add your options here -->
                                </select>
                                <span class="error-message" id="tinhthanhError" style="color: red; display: none;">Vui lòng chọn tỉnh thành.</span>
                            </div>
                            <div class="col-4">
                                <select class="form-select form-select-sm mb-3" id="district" aria-label="Chọn quận huyện">
                                    <option value="" selected>Chọn quận huyện</option>
                                    <!-- Add your options here -->
                                </select>
                                <span class="error-message" id="quanhuyenError" style="color: red; display: none;">Vui lòng chọn quận huyện.</span>
                            </div>
                            <div class="col-4">
                                <select class="form-select form-select-sm mb-3" id="ward" aria-label="Chọn phường xã">
                                    <option value="" selected>Chọn phường xã</option>
                                    <!-- Add your options here -->
                                </select>
                                <span class="error-message" id="phuongxaError" style="color: red; display: none;">Vui lòng chọn phường xã.</span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12">
                                <label>Địa chỉ Chi tiết:</label>
                                <div class="form-group col-12">
                                    <textarea class="form-control" id="diachi1" name="diachi" rows="3"></textarea>
                                    <span class="error-message" id="diachiError" style="color: red; display: none;">Vui lòng nhập địa chỉ cụ thể.</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" id="them" onclick="themdiachi()">Thêm</button>
                    </div>
                </div>
            </div>

        </div>


    </div>
</div>
</div>
</div>
<div id="notification" class="notification">
    Thành Công !
    <div id="progress-bar" class="progress-bar"></div>
</div>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!--<script th:src="@{/assets/js/KhachHangAdd.js}"></script>-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
<script>



</script>
<script>
    var tenTinh = '';
    var tenHuyen = '';
    var tenXa = '';
    function thongtindichiupdate(){
        var tinhThanh = document.getElementById("tinhThanh");
        var quanHuyen = document.getElementById("quanHuyen");
        var phuongXa = document.getElementById("phuongXa");

        var Parameter = {
            url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
            method: "GET",
            responseType: "json",
        };

        axios(Parameter).then(function (response) {
            renderCity(response.data);
        }).catch(function (error) {
            console.error('Lỗi khi lấy dữ liệu: ', error);
        });

        function renderCity(data) {
            // Render danh sách các tỉnh/thành phố vào dropdown tỉnh
            data.forEach(function (city) {
                tinhThanh.options[tinhThanh.options.length] = new Option(city.Name, city.Id);
            });

            // Sự kiện khi chọn tỉnh/thành phố
            tinhThanh.onchange = function () {
                clearOptions(quanHuyen); // Xóa các option cũ của quận huyện
                clearOptions(phuongXa); // Xóa các option cũ của phường xã

                // Lọc ra thông tin của tỉnh/thành phố được chọn
                var selectedCity = data.find(function (city) {
                    return city.Id === tinhThanh.value;
                });

                if (selectedCity) {
                    console.log("Tỉnh thành đã chọn:", selectedCity.Name);
                    // Render các quận/huyện vào dropdown quận huyện
                    selectedCity.Districts.forEach(function (district) {
                        quanHuyen.options[quanHuyen.options.length] = new Option(district.Name, district.Id);
                    });
                }
            };

            // Sự kiện khi chọn quận/huyện
            quanHuyen.onchange = function () {
                clearOptions(phuongXa); // Xóa các option cũ của phường xã

                // Lấy thông tin của tỉnh/thành phố được chọn
                var selectedCity = data.find(function (city) {
                    return city.Id === tinhThanh.value;
                });

                if (selectedCity) {
                    var selectedDistrict = selectedCity.Districts.find(function (district) {
                        return district.Id === quanHuyen.value;
                    });

                    if (selectedDistrict) {
                        console.log("Quận huyện đã chọn:", selectedDistrict.Name);
                        // Render các phường/xã vào dropdown phường xã
                        selectedDistrict.Wards.forEach(function (ward) {
                            phuongXa.options[phuongXa.options.length] = new Option(ward.Name, ward.Id);
                        });
                    }
                }
            };

            // Sự kiện khi chọn phường/xã
            phuongXa.onchange = function () {
                var selectedCity = data.find(function (city) {
                    return city.Id === tinhThanh.value;
                });

                if (selectedCity) {
                    var selectedDistrict = selectedCity.Districts.find(function (district) {
                        return district.Id === quanHuyen.value;
                    });

                    if (selectedDistrict) {
                        var selectedWard = selectedDistrict.Wards.find(function (ward) {
                            return ward.Id === phuongXa.value;
                        });

                        if (selectedWard) {
                            // Lưu tên các địa điểm đã chọn
                            tenXa = selectedWard.Name;
                            tenHuyen = selectedDistrict.Name;
                            tenTinh = selectedCity.Name;

                            // Log chuỗi kết quả ra console
                            var logString = `Địa điểm đã chọn: ${tenXa}, ${tenHuyen}, ${tenTinh}`;
                            console.log(logString);

                            // Ẩn textarea hoặc thực hiện các hành động khác nếu cần
                            // document.getElementById("diaChiChiTiet").style.display = 'none'; // Ví dụ ẩn textarea
                        }
                    }
                }
            };
        }

        function clearOptions(selectElement) {
            while (selectElement.options.length > 0) {
                selectElement.remove(0);
            }
        }

    }
    thongtindichiupdate();
    var citis = document.getElementById("city");
    var districts = document.getElementById("district");
    var wards = document.getElementById("ward");
    var citis2 = '';
    var districts2 = '';
    var wards2 = '';
    var Parameter = {
        url: "https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json",
        method: "GET",
        responseType: "json", // Chỉnh responseType thành json để nhận dữ liệu JSON trực tiếp
    };

    axios(Parameter).then(function (response) {
        renderCity(response.data);
    }).catch(function (error) {
        console.error('Error fetching data: ', error);
    });

    function renderCity(data) {
        // Hàm để render danh sách các tỉnh/thành phố vào dropdown citis
        data.forEach(function (city) {
            citis.options[citis.options.length] = new Option(city.Name, city.Id);
        });

        // Sự kiện khi chọn tỉnh/thành phố
        citis.onchange = function () {
            clearOptions(districts); // Xóa các option cũ của districts
            clearOptions(wards); // Xóa các option cũ của wards

            // Lọc ra thông tin của tỉnh/thành phố được chọn
            var selectedCity = data.find(function (city) {
                return city.Id === citis.value;
            });

            if (selectedCity) {
                // Log tên của tỉnh/thành phố được chọn
                console.log("Selected city:", selectedCity.Name);

                // Render các quận/huyện vào dropdown districts
                selectedCity.Districts.forEach(function (district) {
                    districts.options[districts.options.length] = new Option(district.Name, district.Id);
                });
            }
        };

        // Sự kiện khi chọn quận/huyện
        districts.onchange = function () {
            clearOptions(wards); // Xóa các option cũ của wards

            // Lấy thông tin của tỉnh/thành phố được chọn
            var selectedCity = data.find(function (city) {
                return city.Id === citis.value;
            });

            if (selectedCity) {
                // Lọc ra thông tin của quận/huyện được chọn
                var selectedDistrict = selectedCity.Districts.find(function (district) {
                    return district.Id === districts.value;
                });

                if (selectedDistrict) {
                    // Log tên của quận/huyện được chọn
                    console.log("Selected district:", selectedDistrict.Name);

                    // Render các phường/xã vào dropdown wards
                    selectedDistrict.Wards.forEach(function (ward) {
                        wards.options[wards.options.length] = new Option(ward.Name, ward.Id);

                    });
                }
            }
        };
        wards.onchange = function () {
            // Lấy thông tin của tỉnh/thành phố được chọn
            var selectedCity = data.find(function (city) {
                return city.Id === citis.value;
            });

            if (selectedCity) {
                // Lọc ra thông tin của quận/huyện được chọn
                var selectedDistrict = selectedCity.Districts.find(function (district) {
                    return district.Id === districts.value;
                });

                if (selectedDistrict) {
                    var selectedWard = selectedDistrict.Wards.find(function (ward) {
                        return ward.Id === wards.value;
                    });

                    if (selectedWard) {
                        // Tạo chuỗi để log các thông tin
                        citis2 = selectedWard.Name;
                        districts2 = selectedDistrict.Name;
                        wards2 =  selectedCity.Name;

                        // Log chuỗi kết quả ra console
                        console.log(logString);


                        // Ẩn textarea

                    }
                }
            }
        };


    }


    function clearOptions(selectElement) {
        for (var i = selectElement.options.length - 1; i > 0; i--) {
            selectElement.remove(i);
        }
    }
    function showSuccessMessage() {
        var notification = document.getElementById('notification');
        var progressBar = document.getElementById('progress-bar');

        notification.style.display = 'block';
        progressBar.style.width = '100%';

        setTimeout(function() {
            progressBar.style.width = '0';
        }, 10);

        setTimeout(function() {
            notification.style.display = 'none';
            progressBar.style.width = '100%';
            location.reload();
        }, 3010);
    }
    function validateModalForm() {
        let isValid = true;

        // Get form elements
        const tenNguoiNhan = document.getElementById('tennguoinhan1');
        const tinhThanh = document.getElementById('city');
        const quanHuyen = document.getElementById('district');
        const phuongXa = document.getElementById('ward');
        const diaChi = document.getElementById('diachi1');

        // Reset error messages and styles
        const errorElements = [
            'tennguoinhanError',
            'tinhthanhError',
            'quanhuyenError',
            'phuongxaError',
            'diachiError'
        ];

        errorElements.forEach(errorId => {
            const errorElement = document.getElementById(errorId);
            if (errorElement) {
                errorElement.style.display = 'none';
            }
        });

        [tenNguoiNhan, tinhThanh, quanHuyen, phuongXa, diaChi].forEach(input => {
            input.classList.remove('is-invalid');
        });

        // Validate fields
        if (tenNguoiNhan.value === '') {
            document.getElementById('tennguoinhanError').style.display = 'block';
            tenNguoiNhan.classList.add('is-invalid');
            isValid = false;
        }

        if (tinhThanh.value === '') {
            document.getElementById('tinhthanhError').style.display = 'block';
            tinhThanh.classList.add('is-invalid');
            isValid = false;
        }

        if (quanHuyen.value === '') {
            document.getElementById('quanhuyenError').style.display = 'block';
            quanHuyen.classList.add('is-invalid');
            isValid = false;
        }

        if (phuongXa.value === '') {
            document.getElementById('phuongxaError').style.display = 'block';
            phuongXa.classList.add('is-invalid');
            isValid = false;
        }

        if (diaChi.value === '') {
            document.getElementById('diachiError').style.display = 'block';
            diaChi.classList.add('is-invalid');
            isValid = false;
        }

        return isValid;
    }



    function validateModalForm1() {
        let isValid = true;


        const tenNguoiNhan = document.getElementById('tennguoinhan2');
        const tinhThanh = document.getElementById('tinhThanh');
        const quanHuyen = document.getElementById('quanHuyen');
        const phuongXa = document.getElementById('phuongXa');
        const diaChi = document.getElementById('dcupdate'); // Corrected the ID here

        // Clear previous error messages and styles
        tenNguoiNhan.classList.remove('is-invalid');
        tinhThanh.classList.remove('is-invalid');
        quanHuyen.classList.remove('is-invalid');
        phuongXa.classList.remove('is-invalid');
        diaChi.classList.remove('is-invalid');

        document.getElementById('edit-tennguoinhanError').style.display = 'none';
        document.getElementById('errorTinhThanh').style.display = 'none'; // Adjusted the ID
        document.getElementById('errorQuanHuyen').style.display = 'none'; // Adjusted the ID
        document.getElementById('errorPhuongXa').style.display = 'none'; // Adjusted the ID
        document.getElementById('errorDiaChi').style.display = 'none'; // Adjusted the ID

        // Validate 'Tên Người Nhận'
        if (tenNguoiNhan.value.trim() === '') {
            document.getElementById('edit-tennguoinhanError').style.display = 'block';
            tenNguoiNhan.classList.add('is-invalid');
            isValid = false;
        }

        // Validate 'Tỉnh/Thành phố'
        if (tinhThanh.value === '') {
            document.getElementById('errorTinhThanh').style.display = 'block'; // Adjusted the ID
            tinhThanh.classList.add('is-invalid');
            isValid = false;
        }

        // Validate 'Quận/Huyện'
        if (quanHuyen.value === '') {
            document.getElementById('errorQuanHuyen').style.display = 'block'; // Adjusted the ID
            quanHuyen.classList.add('is-invalid');
            isValid = false;
        }

        // Validate 'Phường/Xã'
        if (phuongXa.value === '') {
            document.getElementById('errorPhuongXa').style.display = 'block'; // Adjusted the ID
            phuongXa.classList.add('is-invalid');
            isValid = false;
        }

        // Validate 'Địa chỉ cụ thể'
        if (diaChi.value.trim() === '') {
            document.getElementById('errorDiaChi').style.display = 'block'; // Adjusted the ID
            diaChi.classList.add('is-invalid');
            isValid = false;
        }

        return isValid;
    }


    let idvuvo = 0;
    let iddc1 = 0;
    var $editTinhThanh = $('#edit-tinhthanh');
    var $editQuanHuyen = $('#edit-quanhuyen');
    var $editPhuongXa = $('#edit-phuongxa');
    var $editTinhThanh1 = $('#tinhthanh');
    var $editQuanHuyen1 = $('#quanhuyen');
    var $editPhuongXa1 = $('#phuongxa');
    var citiesData = [];
    var citiesData1 = [];
    function showform(){
        const modal = document.getElementById('mythemModal');
        const showModalBtn = document.getElementById('show-modal-btn');
        const closeBtn = document.querySelector('.close');
        modal.style.display = 'block';

        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });
    }

    function themdiachi() {
        var tenNguoiNhan = document.getElementById('tennguoinhan1').value;

        var diachi1 = document.getElementById('diachi1').value;


        var diachict = `${diachi1}, ${citis2}, ${districts2}, ${wards2}`;




        const idvuvo1 = {
            id: idvuvo,

        };
        const diaChiData = {
            thanhPho: citis2,
            quanHuyen: districts2,
            phuongXa: wards2,
            soNha: diachi1,
            moTaChiTiet: diachict,
            ten: tenNguoiNhan,
            trangThai: 0,
            idKH : idvuvo1,
            nguoiTao:tenNguoiNhan,
            nguoiCapNhat: tenNguoiNhan

        };
        if (validateModalForm()) {
            $.ajax({
                url: '/adddiachi',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(diaChiData),
                success: function(response) {
                    showSuccessMessage();

                    document.getElementById('myModal').style.display = 'none';
                },
                error: function(xhr, status, error) {
                    console.error('Lỗi khi cập nhật địa chỉ:', error);

                }
            });

        }else{

        }


    }


    function updatediachi() {

        const diaChi = document.getElementById('dcupdate').value;
        const tennguoi = document.getElementById('tennguoinhan2').value;



        const diaChiData = {
            thanhPho: tenTinh,
            quanHuyen: tenHuyen,
            phuongXa: tenXa,
            soNha: diaChi,
            moTaChiTiet: diaChi +','+tenTinh +','+tenHuyen+','+tenXa,
            ten: tennguoi
        };
        console.log(diaChiData);
        if (validateModalForm1()) {
            Swal.fire({
                title: 'Bạn có chắc chắn ?',
                text: "Bạn không thể hoàn tác hành động này!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Vâng, tiếp tục!',
                cancelButtonText: 'Hủy'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire(
                        'Đã xác nhận!',
                        'success'
                    ).then(() => {
                        $.ajax({
                            url: `/api/khach-hang/update-dia-chi/${iddc1}`,
                            method: 'PUT',
                            contentType: 'application/json',
                            data: JSON.stringify(diaChiData),
                            success: function(response) {
                                showSuccessMessage();

                                document.getElementById('myModal').style.display = 'none';
                            },
                            error: function(xhr, status, error) {
                                console.error('Lỗi khi cập nhật địa chỉ:', error);

                            }
                        });

                    });
                } else {
                    Swal.fire(
                        'Đã hủy!',
                        'Hành động của bạn đã bị hủy.',
                        'error'
                    );
                }
            });
        } else {
            console.log("Lỗi");
        }

    }


    function splitAndPopulateAddress(address, tennhan) {
        if (!address) {
            console.error('Address is null or undefined');
            return;
        }

        const addressParts = address.split(',').map(part => part.trim());
        const len = addressParts.length;

        if (len >= 4) {
            const city = addressParts[len - 1];
            const district = addressParts[len - 2];
            const ward = addressParts[len - 3];
            const specificAddress = addressParts.slice(0, len - 3).join(', ');

            // Set the recipient's name
            $('#tennguoinhan2').val(tennhan);
            // Set the specific address
            $('#dcupdate').val(specificAddress); // Updated ID

            // Set the province/city, district, and ward with slight delays
            setTimeout(function() {
                $('#tinhThanh').val($('#tinhThanh option:contains("' + city + '")').val()).change();
            }, 100);

            setTimeout(function() {
                $('#quanHuyen').val($('#quanHuyen option:contains("' + district + '")').val()).change();
            }, 100);

            setTimeout(function() {
                $('#phuongXa').val($('#phuongXa option:contains("' + ward + '")').val());
            }, 100);
        } else {
            console.error('Invalid address format:', address);
        }
    }

    function getThongTinKhachHang() {
        $.ajax({
            url: 'https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json',
            dataType: 'json',
            success: function(data) {
                citiesData = data;
                $editTinhThanh.empty().append('<option value="" selected>Chọn tỉnh thành</option>');
                $.each(data, function(index, city) {
                    $editTinhThanh.append('<option value="' + city.Id + '">' + city.Name + '</option>');
                });
            },
            error: function(xhr, status, error) {
                console.error('Lỗi khi tải dữ liệu:', error);
            }
        });

        $editTinhThanh.on('change', function() {
            var cityId = $(this).val();
            if (cityId) {
                $editQuanHuyen.empty().append('<option value="" selected>Chọn quận huyện</option>');
                var selectedCity = citiesData.find(city => city.Id === cityId);
                if (selectedCity) {
                    $.each(selectedCity.Districts, function(index, district) {
                        $editQuanHuyen.append('<option value="' + district.Id + '">' + district.Name + '</option>');
                    });
                }
            } else {
                $editQuanHuyen.empty().append('<option value="" selected>Chọn quận huyện</option>');
                $editPhuongXa.empty().append('<option value="" selected>Chọn phường xã</option>');
            }
        });

        $editQuanHuyen.on('change', function() {
            var districtId = $(this).val();
            if (districtId) {
                // Clear and populate phường/xã dropdown
                $editPhuongXa.empty().append('<option value="" selected>Chọn phường xã</option>');
                var selectedDistrict = citiesData.flatMap(city => city.Districts).find(district => district.Id === districtId);
                if (selectedDistrict) {
                    $.each(selectedDistrict.Wards, function(index, ward) {
                        $editPhuongXa.append('<option value="' + ward.Id + '">' + ward.Name + '</option>');
                    });
                }
            } else {
                $editPhuongXa.empty().append('<option value="" selected>Chọn phường xã</option>');
            }
        });
    }
    function getThongTinKhachHang1() {
        $.ajax({
            url: 'https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json',
            dataType: 'json',
            success: function(data) {
                citiesData1 = data;
                $editTinhThanh1.empty().append('<option value="" selected>Chọn tỉnh thành</option>');
                $.each(data, function(index, city) {
                    $editTinhThanh1.append('<option value="' + city.Id + '">' + city.Name + '</option>');
                });
            },
            error: function(xhr, status, error) {
                console.error('Lỗi khi tải dữ liệu:', error);
            }
        });

        $editTinhThanh1.on('change', function() {
            var cityId = $(this).val();
            if (cityId) {
                $editQuanHuyen1.empty().append('<option value="" selected>Chọn quận huyện</option>');
                var selectedCity = citiesData1.find(city => city.Id === cityId);
                if (selectedCity) {
                    $.each(selectedCity.Districts, function(index, district) {
                        $editQuanHuyen1.append('<option value="' + district.Id + '">' + district.Name + '</option>');
                    });
                }
            } else {
                $editQuanHuyen1.empty().append('<option value="" selected>Chọn quận huyện</option>');
                $editPhuongXa1.empty().append('<option value="" selected>Chọn phường xã</option>');
            }
        });

        $editQuanHuyen1.on('change', function() {
            var districtId = $(this).val();
            if (districtId) {
                // Clear and populate phường/xã dropdown
                $editPhuongXa1.empty().append('<option value="" selected>Chọn phường xã</option>');
                var selectedDistrict = citiesData1.flatMap(city => city.Districts).find(district => district.Id === districtId);
                if (selectedDistrict) {
                    $.each(selectedDistrict.Wards, function(index, ward) {
                        $editPhuongXa1.append('<option value="' + ward.Id + '">' + ward.Name + '</option>');
                    });
                }
            } else {
                $editPhuongXa1.empty().append('<option value="" selected>Chọn phường xã</option>');
            }
        });
    }

    function validateChangePasswordForm() {
        // Get form elements
        const matKhauHienTai = document.getElementById('matkhauhientai');
        const matKhauMoi = document.getElementById('matkhaumoi');
        const nhapLaiMatKhauMoi = document.getElementById('nhaplaimatkhaumoi');

        // Get error message elements
        const matKhauHienTaiError = document.getElementById('matkhauhientaiError');
        const matKhauMoiError = document.getElementById('matkhaumoiError');
        const nhapLaiMatKhauMoiError = document.getElementById('nhaplaimatkhaumoiError');

        // Clear previous error messages and styles
        matKhauHienTai.classList.remove('is-invalid');
        matKhauMoi.classList.remove('is-invalid');
        nhapLaiMatKhauMoi.classList.remove('is-invalid');

        matKhauHienTaiError.style.display = 'none';
        matKhauMoiError.style.display = 'none';
        nhapLaiMatKhauMoiError.style.display = 'none';

        let isValid = true;

        // Validate 'Mật Khẩu Cũ'
        if (matKhauHienTai.value.trim() === '') {
            matKhauHienTaiError.style.display = 'block';
            matKhauHienTai.classList.add('is-invalid');
            isValid = false;
        }

        // Validate 'Mật Khẩu Mới'
        const matKhauMoiValue = matKhauMoi.value.trim();
        const passwordPattern = /^(?=.*[a-zA-Z])(?=.*\d)[a-zA-Z\d]{8,}$/;

        if (matKhauMoiValue === '') {
            matKhauMoiError.textContent = 'Vui lòng nhập mật khẩu mới.';
            matKhauMoiError.style.display = 'block';
            matKhauMoi.classList.add('is-invalid');
            isValid = false;
        } else if (!passwordPattern.test(matKhauMoiValue)) {
            matKhauMoiError.textContent = 'Mật khẩu mới phải có ít nhất 8 ký tự, bao gồm cả chữ và số.';
            matKhauMoiError.style.display = 'block';
            matKhauMoi.classList.add('is-invalid');
            isValid = false;
        }

        // Validate 'Nhập Lại Mật Khẩu Mới'
        const nhapLaiMatKhauMoiValue = nhapLaiMatKhauMoi.value.trim();
        if (nhapLaiMatKhauMoiValue === '') {
            nhapLaiMatKhauMoiError.textContent = 'Vui lòng nhập lại mật khẩu mới.';
            nhapLaiMatKhauMoiError.style.display = 'block';
            nhapLaiMatKhauMoi.classList.add('is-invalid');
            isValid = false;
        } else if (matKhauMoiValue !== nhapLaiMatKhauMoiValue) {
            nhapLaiMatKhauMoiError.textContent = 'Mật khẩu nhập lại không khớp với mật khẩu mới.';
            nhapLaiMatKhauMoiError.style.display = 'block';
            nhapLaiMatKhauMoi.classList.add('is-invalid');
            isValid = false;
        }

        return isValid;
    }

    function doimatkhau() {
        const mkcu = document.getElementById('matkhauhientai').value.trim();
        const mkmoi = document.getElementById('matkhaumoi').value.trim();
        const nhaplaimkmoi = document.getElementById('nhaplaimatkhaumoi').value.trim();
        if (validateChangePasswordForm()) {
            Swal.fire({
                title: 'Bạn có chắc chắn ?',
                text: "Bạn không thể hoàn tác hành động này!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Vâng, tiếp tục!',
                cancelButtonText: 'Hủy'
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire(
                        'Đã xác nhận!',
                        'Bạn đã thay đỏi.',
                        'success'
                    ).then(() => {
                        if (mkmoi === nhaplaimkmoi) {
                            $.ajax({
                                url: '/api/session/user',
                                method: 'GET',
                                success: function (response) {
                                    var mkkh = response.matKhau;
                                    if (mkkh === mkcu) {
                                        if (mkmoi === mkcu) {
                                            alert('Mật khẩu mới không được trùng với mật khẩu cũ')
                                        } else {

                                            $.ajax({
                                                url: `/update-khach-hang-clientmk/${idvuvo}/${mkmoi}`,
                                                method: 'POST',
                                                contentType: 'application/json',
                                                success: function (response) {
                                                    showSuccessMessage();
                                                },
                                                error: function (xhr, status, error) {
                                                    alert('Có lỗi xảy ra: ' + error);
                                                }
                                            });
                                        }
                                    } else {
                                        alert('Mật khẩu đã nhập không đúng')
                                    }

                                },
                            });

                        }
                        console.log("Form is valid, proceed to change password.");
                    });
                } else {
                    Swal.fire(
                        'Đã hủy!',
                        'Hành động của bạn đã bị hủy.',
                        'error'
                    );
                }
            });

        } else {
            console.log("Form is invalid, show errors.");
        }


    }
    function getdiachiId(iddc){
        iddc1=iddc;
        $.ajax({
            url: `/diachiid/${iddc}`,
            method: 'GET',
            success: function(response) {
                splitAndPopulateAddress(response.moTaChiTiet,response.ten);

            },
            error: function(error) {
                console.error('Lỗi khi lấy thông tin địa chỉ:', error);
            }
        });
    }
    function validateForm() {
        let isValid = true;

        // Get form elements
        const ten = document.getElementById('ten');
        const sdt = document.getElementById('sdt');
        const cccd = document.getElementById('cccd');
        const ngaySinh = document.getElementById('ngaySinh');
        const email = document.getElementById('email');

        // Clear previous error messages and styles
        ten.classList.remove('is-invalid');
        sdt.classList.remove('is-invalid');
        cccd.classList.remove('is-invalid');
        ngaySinh.classList.remove('is-invalid');
        email.classList.remove('is-invalid');

        document.getElementById('tenError').innerText = '';
        document.getElementById('sdtError').innerText = '';
        document.getElementById('cccdError').innerText = '';
        document.getElementById('ngaySinhError').innerText = '';
        document.getElementById('emailError').innerText = '';


        if (ten.value.trim() === '') {
            document.getElementById('tenError').innerText = 'Vui lòng nhập tên khách hàng';
            ten.classList.add('is-invalid');
            isValid = false;
        }

        // // Validate 'Số Điện Thoại'
        // const phoneRegex = /^[0-9]{10}$/;
        // if (sdt.value.trim() === '') {
        //     document.getElementById('sdtError').innerText = 'Vui lòng nhập số điện thoại';
        //     sdt.classList.add('is-invalid');
        //     isValid = false;
        // } else if (!phoneRegex.test(sdt.value.trim())) {
        //     document.getElementById('sdtError').innerText = 'Số điện thoại phải là số và gồm 10 chữ số';
        //     sdt.classList.add('is-invalid');
        //     isValid = false;
        // }

        // Validate 'CCCD'
        if (cccd.value.trim() === '') {
            document.getElementById('cccdError').innerText = 'Vui lòng nhập CCCD';
            cccd.classList.add('is-invalid');
            isValid = false;
        }

        // Validate 'Ngày Sinh'
        if (ngaySinh.value === '') {
            document.getElementById('ngaySinhError').innerText = 'Vui lòng chọn ngày sinh';
            ngaySinh.classList.add('is-invalid');
            isValid = false;
        }

        // Validate 'Email'
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // Basic email regex
        if (email.value.trim() === '') {
            document.getElementById('emailError').innerText = 'Vui lòng nhập email';
            email.classList.add('is-invalid');
            isValid = false;
        } else if (!emailRegex.test(email.value.trim())) {
            document.getElementById('emailError').innerText = 'Email không hợp lệ';
            email.classList.add('is-invalid');
            isValid = false;
        }

        return isValid;
    }

    function updateTrangThaidc(id, trangThai) {
        Swal.fire({
            title: 'Bạn có chắc chắn ?',
            text: "Bạn không thể hoàn tác hành động này!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Vâng, tiếp tục!',
            cancelButtonText: 'Hủy'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire(
                    'Đã xác nhận!',
                    'success'
                ).then(() => {
                    $.ajax({
                        url: `/updatemacdinh/${id}`,
                        type: 'POST',
                        data: {trangThai: trangThai},
                        success: function (response) {
                            // getDiaChi(idvuvo);
                            showSuccessMessage();
                        },
                        error: function (xhr, status, error) {
                            console.error('Error updating Trang Thai:', status, error);
                        }
                    });

                });
            } else {
                Swal.fire(
                    'Đã hủy!',
                    'Hành động của bạn đã bị hủy.',
                    'error'
                );
            }
        });

    }

    function xoadiachi(id) {

        Swal.fire({
            title: 'Bạn có chắc chắn ?',
            text: "Bạn không thể hoàn tác hành động này!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Vâng, tiếp tục!',
            cancelButtonText: 'Hủy'
        }).then((result) => {
            if (result.isConfirmed) {
                Swal.fire(
                    'Đã xác nhận!',
                    'success'
                ).then(() => {
                    $.ajax({
                        url: `/deletediachikh/${id}`,
                        type: 'DELETE',
                        success: function (response) {
                            showSuccessMessage();
                        },
                        error: function (xhr, status, error) {
                            console.error('Error deleting DiaChi:', status, error);
                        }
                    });

                });
            } else {
                Swal.fire(
                    'Đã hủy!',
                    'Hành động của bạn đã bị hủy.',
                    'error'
                );
            }
        });

    }


    function getDiaChi(khId) {

        if (khId) {
            var addressDetailsContainer = $('#address-details');
            addressDetailsContainer.empty();

            $.ajax({
                url: '/api/khach-hang/dia-chi/' + khId,
                method: 'GET',
                cache: false,
                dataType: 'json',
                success: function (data) {
                    var tennguoinhan = '';
                    console.log('Received data:', data);
                    if (data && data.length > 0) {
                        data.forEach(function (diaChi) {
                            var trangThaiClass = diaChi.trangThai === 1 ? 'Mặc Định' : 'Thiết Lập Mặc Định';
                            var update = diaChi.trangThai === 1 ? 'Cập Nhật' : 'Xóa';
                            addressDetailsContainer.append(`
                        <div class="address-block mb-3">
                            <div class="d-flex align-items-center">
                                <div style="flex: 1; display: flex; align-items: center;text-align: left">
                                    <div style="margin-left: 10px;">
                                        <p style="display: block; margin-bottom: 3px; font-size: 14px;">${diaChi.ten}</p>
                                        <p style="margin: 0; font-size: 12px;">${diaChi.moTaChiTiet}</p>
                                    </div>
                                </div>
                                <div style="text-align: right;margin-left: 20px">
                                    <a href="#" class="btn btn-outline-orange btn-sm update-address" data-dia-chi-id="${diaChi.id}" style="border: 1px solid orange; background-color: white; color: black;">
                                       ${update}
                                    </a>
                                    <a href="#" class="btn btn-outline-orange btn-sm thiet-lap" data-dia-chi-id="${diaChi.id}" style="border: 1px solid orange; background-color: white; color: black;">
                                         <p>${trangThaiClass}</p>
                                    </a>
                                </div>
                            </div>
                        </div>
                    `);
                        });


                        $(document).on('click', '.update-address', function (event) {
                            event.preventDefault();

                            var text = $(this).text().trim();
                            var diaChiId = $(this).data('dia-chi-id');

                            if (text === 'Xóa') {
                                xoadiachi(diaChiId);
                            } else {
                                const modal = document.getElementById('myModal');
                                const showModalBtn = document.getElementById('show-modal-btn');
                                const closeBtn = document.querySelector('.close-btn');
                                getdiachiId(diaChiId);
                                modal.style.display = 'block';



                                closeBtn.addEventListener('click', () => {
                                    modal.style.display = 'none';
                                });

                            }
                        });

                        $(document).on('click', '.thiet-lap', function (event) {
                            event.preventDefault();

                            var text = $(this).text().trim();
                            var diaChiId = $(this).data('dia-chi-id');

                            if (text === 'Thiết Lập Mặc Định') {

                                updateTrangThaidc(diaChiId, 1);
                            } else {

                            }
                        });


                    } else {
                        console.log('No address data available');
                        addressDetailsContainer.append('<li>Khách Hàng chưa cập nhật địa chỉ</li>');
                    }

                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.error('Failed to load address data', textStatus, errorThrown);
                    addressDetailsContainer.empty();
                    addressDetailsContainer.append('<li>Không thể tải địa chỉ</li>');
                }
            });
        } else {
            console.error("Customer ID is undefined or null");
        }
    }


    $(document).ready(function () {
        // Handle heart icon click
        getThongTinKhachHang();
        getThongTinKhachHang1();
        let idKhachHang = null;

        function getKhachHang() {
            $.ajax({
                url: '/api/session/user',
                method: 'GET',
                success: function (response) {
                    let ten = response.ten;

                    idKhachHang = response.id;

                    getDuLieuGioHangVaGioHangChiTiet(idKhachHang);

                    getdlkh(response.id)


                    if (response.gioiTinh === 'true') {
                        document.getElementById('nam').checked = true;
                    } else {
                        document.getElementById('nu').checked = true;
                    }
                    $('#tenKhachHang').text(response.ten);
                },
            });
        }

        getKhachHang();

        function getDuLieuGioHangVaGioHangChiTiet(idKhachHang) {
            $.ajax({
                url: `/api/gio-hang/detail/${idKhachHang}`,
                method: 'GET',
                success: function (response) {
                    const gioHangChiTiet = response.ghct;
                    const  gioHang = response.gh

                    var count = gioHangChiTiet.length ? gioHangChiTiet.length : 0;
                    document.getElementById('cart-count').textContent = count;

                },
            });

        }

        function getdlkh(id) {
            $.ajax({
                url: `/khach-hang-client/${id}`,
                method: 'GET',
                success: function (kh) {

                    document.getElementById('ten').value = kh.ten || '';
                    document.getElementById('sdt').value = kh.sdt || '';
                    document.getElementById('cccd').value = kh.cccd || '';
                    document.getElementById('ngaySinh').value = kh.ngaySinh || '';
                    document.getElementById('email').value = kh.email || '';
                    getDiaChi(kh.id);
                    idvuvo = kh.id;
                },
                error: function (xhr, status, error) {
                    alert('Có lỗi xảy ra: ' + error);
                }
            });
        }

        function resetLinkStates() {
            $('#hoSoLink').removeClass('active-link');
            $('#diaChiLink').removeClass('active-link');
            $('#doiMatKhauLink').removeClass('active-link');
        }

        $('#hoSoLink').click(function (event) {
            event.preventDefault();
            $('#formContainer').removeClass('hidden');
            $('#diachi').addClass('hidden');
            $('#helloDiv').addClass('hidden');
            resetLinkStates();
            $(this).addClass('active-link');
        });

        $('#diaChiLink').click(function (event) {
            event.preventDefault();
            $('#formContainer').addClass('hidden');
            $('#helloDiv').addClass('hidden');
            $('#diachi').removeClass('hidden');
            resetLinkStates();
            $(this).addClass('active-link');
        });

        $('#doiMatKhauLink').click(function (event) {
            event.preventDefault();
            $('#formContainer').addClass('hidden');
            $('#diachi').addClass('hidden');
            $('#helloDiv').removeClass('hidden');
            resetLinkStates();
            $(this).addClass('active-link');
        });


    });

    function check123() {
        if (!validateForm()) {
            event.preventDefault();
        } else {
            const formData = {
                ten: $('#ten').val(),
                sdt: $('#sdt').val(),
                cccd: $('#cccd').val(),
                ngaySinh: $('#ngaySinh').val(),
                email: $('#email').val(),
                gioiTinh: $('input[name="gioiTinh"]:checked').val()
            };

            $.ajax({
                url: `/update-khach-hang-client/${idvuvo}`,
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(formData),
                success: function (response) {

                },
                error: function (xhr, status, error) {
                    alert('Có lỗi xảy ra: ' + error);
                }
            });
        }
    }

</script>

</body>
<div th:replace="~{client/fragmentsClient/footer :: footer}"></div>

</html>
